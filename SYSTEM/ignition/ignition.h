/**
 * @file    ignition.h
 * @brief   点火控制模块
 * @author  Refactored from system_control.c
 * @date    2024-12-27
 * @version 1.0
 * 
 * @details 本模块负责：
 *          - 点火前准备（风门、排污、延时）
 *          - 点火主流程状态机
 *          - 点火过程检测
 *          - 系统启动流程
 */

#ifndef __IGNITION_H
#define __IGNITION_H

#include "main.h"

/*==============================================================================
 * 宏定义
 *============================================================================*/
#define Max_Ignition_Times  3   /* 最大点火尝试次数 */

/*==============================================================================
 * 点火状态机索引定义
 *============================================================================*/
/* Ignition_Index 状态定义:
 * 0  - 初始状态，复位计数器，开始前扫
 * 1  - 检查水位，执行正式前扫
 * 2  - 风门切换，功率调整
 * 3  - 正式点火准备
 * 4  - 点火器启动
 * 5  - 开燃气
 * 6  - 等待火焰检测
 * 7  - 火焰检测结果处理
 * 8  - 稳火等待
 * 9  - 点火失败重试
 * 10 - 前扫等待
 */

/*==============================================================================
 * 函数声明
 *============================================================================*/

/**
 * @brief  点火前准备
 * @param  无
 * @retval 1=准备完成, 0=准备中
 * @note   包含风门开启、排污门关闭、延时等待等操作
 *         通过 sys_flag.before_ignition_index 控制状态
 */
uint8 Before_Ignition_Prepare(void);

/**
 * @brief  点火主流程状态机
 * @param  无
 * @retval 1=点火成功, 0=点火中
 * @note   10个case状态机控制完整点火流程
 *         通过 Ignition_Index 控制状态
 */
uint8 Sys_Ignition_Fun(void);

/**
 * @brief  点火过程检测
 * @param  无
 * @retval 无
 * @note   检测烟温、燃气压力等
 */
void Ignition_Check_Fun(void);

/**
 * @brief  系统启动流程
 * @param  无
 * @retval 无
 * @note   通过 Sys_Launch_Index 控制启动阶段:
 *         0=自检, 1=点火, 2=运行
 */
void Sys_Launch_Function(void);

#endif /* __IGNITION_H */

