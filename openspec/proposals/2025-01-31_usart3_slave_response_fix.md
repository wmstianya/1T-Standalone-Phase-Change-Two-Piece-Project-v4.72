# å˜æ›´ææ¡ˆ: ä¸²å£3ç›¸å˜åŒæ‹¼æ¨¡å¼é€šè®¯å†²çªä¿®å¤

**Date**: 2025-01-31  
**Author**: AI Assistant  
**Status**: ğŸ“ Draft - å¾…å®¡æ‰¹

---

## 1. é—®é¢˜æè¿°

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **ç°è±¡** | ç›¸å˜åŒæ‹¼æ¨¡å¼ä¸‹ä¸²å£3**å¶å‘**æ˜¾ç¤º"åˆ†æœºè¿çº¿ï¼Œæ— è¿æ¥" |
| **å½±å“èŒƒå›´** | `Device_Style == 3` (ç›¸å˜åŒæ‹¼) æ¨¡å¼ |
| **ä¸¥é‡ç¨‹åº¦** | é«˜ (è”åŠ¨æ§åˆ¶ä¸ç¨³å®š) |
| **ç‰¹å¾** | å¶å‘æ€§ï¼Œä¸æ˜¯æŒç»­å¤±è” |

---

## 2. ä¸²å£3åŠŸèƒ½æ¢³ç†

### 2.1 è®¾å¤‡åˆ—è¡¨

ä¸²å£3æ˜¯ä¸€æ¡å…±äº«RS485æ€»çº¿ï¼ŒæŒ‚è½½äº†å¤šä¸ªè®¾å¤‡ï¼š

| åœ°å€ | è®¾å¤‡ | åŠŸèƒ½ | å¯ç”¨æ¡ä»¶ |
|------|------|------|----------|
| **2,3** | ä»æœºé”…ç‚‰ | æœºç»„è”åŠ¨æ•°æ® | `Device_Style == 2/3` |
| **8** | å˜é¢‘è¡¥æ°´æ³µ | è¯»çŠ¶æ€/å†™å¼€åº¦ | `Water_BianPin_Enabled` |
| **10** | 4-20mAæ‰©å±•æ¨¡å— | å·®å‹æ¶²ä½æ£€æµ‹ | `ChaYa_WaterHigh_Enabled` |

### 2.2 ç¡¬ä»¶è¿æ¥

æ¯å°é”…ç‚‰éƒ½æœ‰è‡ªå·±çš„å˜é¢‘æ³µå’Œå·®å‹æ¨¡å—ï¼Œæ¥åœ¨å„è‡ªçš„ä¸²å£3ä¸Šï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RS485 æ€»çº¿ (ä¸²å£3)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       â”‚  ä¸»æœº    â”‚       â”‚  ä»æœº    â”‚       â”‚ å˜é¢‘æ³µ  â”‚
       â”‚ (åœ°å€0) â”‚       â”‚ (åœ°å€2) â”‚       â”‚ (åœ°å€8) â”‚
       â”‚         â”‚       â”‚         â”‚       â”‚         â”‚
       â”‚ æœ‰è‡ªå·±çš„ â”‚       â”‚ æœ‰è‡ªå·±çš„ â”‚       â”‚ (è¢«åŠ¨)  â”‚
       â”‚ æ³µå’Œå·®å‹ â”‚       â”‚ æ³µå’Œå·®å‹ â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ ¹å› åˆ†æ

### 3.1 é—®é¢˜ä»£ç ä½ç½®

**æ–‡ä»¶**: `HARDWARE/USART3/usart3.c`  
**å‡½æ•°**: `Modbus3_UnionTx_Communication()`

#### å…³é”®åˆ†æµç‚¹ (Line 793-800)

```c
//ä¸»ç®¡ä»æœº
if(sys_flag.Address_Number == 0)  // ä¸»æœº
    {
        Address++;  // â†’ case 2,3 æŸ¥è¯¢ä»æœº
    }
else  // âš ï¸ ä»æœºèµ°è¿™é‡Œï¼
    {
        Address = 4;  // â†’ case 4 ç›´æ¥å»æŸ¥è¯¢å˜é¢‘æ³µ
    }
```

#### ä»æœºä¸»åŠ¨å‘é€ä½ç½®

| ä»£ç è¡Œ | case | åŠ¨ä½œ |
|--------|------|------|
| Line 834 | case 4 | `FuNiSen_Read_WaterDevice_Function()` æŸ¥è¯¢å˜é¢‘æ³µ |
| Line 866 | case 5 | `Usart_SendStr_length(USART3,...)` æŸ¥è¯¢å·®å‹æ¨¡å— |

### 3.2 æ—¶åºå†²çªæµç¨‹å›¾

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    RS485 æ€»çº¿ (ä¸²å£3) - ç›¸å˜åŒæ‹¼æ¨¡å¼                    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ä¸»æœº    â”‚                â”‚  ä»æœº    â”‚                â”‚ å˜é¢‘æ³µ  â”‚
   â”‚(åœ°å€0)  â”‚                â”‚(åœ°å€2)  â”‚                â”‚(åœ°å€8)  â”‚
   â”‚         â”‚                â”‚         â”‚                â”‚         â”‚
   â”‚ ç¨‹åºå…¥å£ â”‚                â”‚ ç¨‹åºå…¥å£ â”‚                â”‚(è¢«åŠ¨)   â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚
        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ case 1: æ›´æ–°æœ¬æœº   â”‚      â”‚ case 1: æ›´æ–°æœ¬æœº   â”‚
â”‚ Address_Number==0 â”‚      â”‚ Address_Number!=0 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚
         â–¼                          â–¼
    Address++               Address = 4  â† âš ï¸ è·³è½¬ï¼
         â”‚                          â”‚
         â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ case 2: æŸ¥è¯¢ä»æœº2  â”‚               â”‚
â”‚ JiZu_ReadAndWrite â”‚               â”‚
â”‚ Function(2)       â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â”‚                          â”‚
         â”‚ å‘é€åˆ°æ€»çº¿               â”‚
         â–¼                          â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•—           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â•‘  >>>>>>>  â•‘           â”‚ case 4: æŸ¥è¯¢å˜é¢‘æ³µ â”‚
    â•‘  æ€»çº¿ä¸Š   â•‘           â”‚ FuNiSen_Read_     â”‚
    â•‘  çš„æ•°æ®   â•‘           â”‚ WaterDevice()     â”‚
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                          â”‚
         â”‚                          â”‚ å‘é€åˆ°æ€»çº¿
         â”‚                          â–¼
         â”‚                    â•”â•â•â•â•â•â•â•â•â•â•â•â•—
         â”‚                    â•‘  >>>>>>>  â•‘
         â”‚                    â•‘  æ€»çº¿ä¸Š   â•‘
         â”‚                    â•‘  çš„æ•°æ®   â•‘
         â”‚                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•
         â”‚                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘   ğŸ’¥ æ€»çº¿å†²çªï¼ğŸ’¥          â•‘
        â•‘                           â•‘
        â•‘  ä¸»æœºå‘é€: 02 03 00 64... â•‘
        â•‘  ä»æœºå‘é€: 08 03 00 00... â•‘
        â•‘                           â•‘
        â•‘  æ•°æ®ç¢°æ’ â†’ ä¹±ç           â•‘
        â•‘  CRCæ ¡éªŒå¤±è´¥              â•‘
        â•‘  SlaveG[2].Send_Flag++    â•‘
        â•‘  è¶…è¿‡30æ¬¡ â†’ å¤±è”ï¼        â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 3.3 è½®è¯¢æ—¶åºå¯¹æ¯”

```
æ—¶é—´ â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’

ä¸»æœº (Address_Number == 0):
â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚case1 â”‚â”€â”€â–ºâ”‚case2 â”‚â”€â”€â–ºâ”‚case3 â”‚â”€â”€â–ºâ”‚case4 â”‚â”€â”€â–ºâ”‚case5 â”‚â”€â”€â–ºâ”‚case6 â”‚â”€â”€â–ºå¾ªç¯
â”‚æœ¬æœº  â”‚   â”‚ä»æœº2 â”‚   â”‚ä»æœº3 â”‚   â”‚å˜é¢‘æ³µâ”‚   â”‚å·®å‹  â”‚   â”‚ç­‰å¾…  â”‚
â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚          â”‚          â”‚
              â–¼          â–¼          â–¼          â–¼
           [TXåˆ°æ€»çº¿] [TXåˆ°æ€»çº¿] [TXåˆ°æ€»çº¿] [TXåˆ°æ€»çº¿]


ä»æœº (Address_Number != 0):
â”Œâ”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚case1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚case4 â”‚â”€â”€â–ºâ”‚case5 â”‚â”€â”€â–ºâ”‚case6 â”‚â”€â”€â–ºå¾ªç¯
â”‚æœ¬æœº  â”‚   è·³è¿‡ case2,3          â”‚å˜é¢‘æ³µâ”‚   â”‚å·®å‹  â”‚   â”‚ç­‰å¾…  â”‚
â””â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚          â”‚
                                    â–¼          â–¼
                                 [TXåˆ°æ€»çº¿] [TXåˆ°æ€»çº¿]
                                    â”‚          â”‚
                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                    âš ï¸ ä¸ä¸»æœºçš„å‘é€æ—¶åºå†²çªï¼
```

### 3.4 ä¸ºä»€ä¹ˆæ˜¯"å¶å‘"é—®é¢˜ï¼Ÿ

| æƒ…å†µ | ç»“æœ |
|------|------|
| ä¸»æœºå’Œä»æœºå‘é€æ—¶åº**é”™å¼€** | é€šè®¯æ­£å¸¸ âœ… |
| ä¸»æœºå’Œä»æœºå‘é€æ—¶åº**é‡å ** | æ€»çº¿å†²çªï¼Œæ•°æ®ä¹±ç  âŒ |

ç”±äºä¸¤è¾¹è½®è¯¢å‘¨æœŸç•¥æœ‰å·®å¼‚ï¼Œå†²çªæ˜¯æ¦‚ç‡æ€§çš„ï¼Œæ‰€ä»¥è¡¨ç°ä¸º**å¶å‘**å¤±è”ã€‚

---

## 4. è§£å†³æ–¹æ¡ˆ

### 4.1 æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **A: ä»æœºä¸ä¸»åŠ¨å‘é€** | ä»æœºè·³è¿‡ case4/5ï¼Œä¸æŸ¥è¯¢è‡ªå·±çš„æ³µå’Œå·®å‹ | ç®€å•ï¼Œæ— æ€»çº¿å†²çª | ä»æœºæ— æ³•æ§åˆ¶è‡ªå·±çš„æ³µ |
| **B: ä¸»æœºç»Ÿä¸€ç®¡ç†** | ä¸»æœºæŸ¥è¯¢ä»æœºæ—¶ï¼Œé¡ºå¸¦è·å–ä»æœºçš„æ³µ/å·®å‹æ•°æ® | æ¶æ„æ¸…æ™° | éœ€è¦ä¿®æ”¹åè®® |
| **C: ä»æœºå“åº”å¼** | ä»æœºåªåœ¨ä¸»æœº"å…è®¸"åæ‰å‘é€ | å…¼å®¹ç°æœ‰æ¶æ„ | å¤æ‚åº¦é«˜ |
| **D: åˆ†æ—¶å¤ç”¨** | ä»æœºç­‰å¾…ä¸»æœºå®Œæˆåå†å‘é€ | ä¿ç•™ä»æœºåŠŸèƒ½ | éœ€è¦åŒæ­¥æœºåˆ¶ |

### 4.2 æ¨èæ–¹æ¡ˆ: æ–¹æ¡ˆA + è¡¥å……

**æ ¸å¿ƒæ€è·¯**: ä»æœºä¸ä¸»åŠ¨æŸ¥è¯¢å˜é¢‘æ³µå’Œå·®å‹æ¨¡å—ï¼Œæ”¹ç”±ä¸»æœºç»Ÿä¸€ç®¡ç†ã€‚

#### ä¿®æ”¹ç‚¹1: ä»æœºè·³è¿‡ case4/5

```c
// usart3.c: Modbus3_UnionTx_Communication()
// ä¿®æ”¹ Line 798-800

if(sys_flag.Address_Number == 0)  // ä¸»æœº
{
    Address++;  // â†’ case 2,3 æŸ¥è¯¢ä»æœº
}
else  // ä»æœº
{
    Address = 1;  // ã€ä¿®æ”¹ã€‘ç›´æ¥å›åˆ° case1ï¼Œä¸æŸ¥è¯¢æ³µå’Œå·®å‹
    // åŸ: Address = 4;
}
```

#### ä¿®æ”¹ç‚¹2: ä»æœºå“åº”ä¸»æœºæŸ¥è¯¢

ä¸»æœºé€šè¿‡ç°æœ‰çš„ `ModBus3_RTU_Read03(2, 100, 18)` æŸ¥è¯¢ä»æœºæ—¶ï¼Œä»æœºéœ€è¦åœ¨å“åº”æ•°æ®ä¸­åŒ…å«è‡ªå·±çš„æ³µçŠ¶æ€å’Œå·®å‹æ•°æ®ã€‚

åœ¨ `Modbus3_UnionRx_DataProcess()` çš„æ•°æ®æ˜ å°„ä¸­å·²ç»æœ‰ï¼š
- `U3_Inf.RX_Data[34]` - è¡¥æ°´ä¿¡å· (Water_State.CSignal)
- `U3_Inf.RX_Data[35-36]` - å·®å‹æ¶²ä½

**éœ€è¦æ–°å¢ä»æœºå“åº”å‡½æ•°**ï¼Œè®©ä»æœºèƒ½å›å¤ä¸»æœºçš„æŸ¥è¯¢ï¼ˆåŒ…å«æ³µå’Œå·®å‹æ•°æ®ï¼‰ã€‚

#### ä¿®æ”¹ç‚¹3: æ–°å¢ä»æœºå“åº”å‡½æ•°

```c
/**
 * @brief  ä»æœºå“åº”ä¸»æœºçš„ModbusæŸ¥è¯¢
 * @note   åœ¨ ModBus_Uart3_LocalRX_Communication() ä¸­è°ƒç”¨
 */
void ModBus3_SlaveResponse(void)
{
    uint8 myAddress;
    uint8 targetAddr;
    uint8 command;
    
    /* éä»æœºæ¨¡å¼ä¸å¤„ç† */
    if(sys_flag.Address_Number == 0)
    {
        return;
    }
    
    myAddress = sys_flag.Address_Number;
    targetAddr = U3_Inf.RX_Data[0];
    
    /* ä¸æ˜¯å‘ç»™æœ¬æœºçš„å‘½ä»¤ï¼Œå¿½ç•¥ */
    if(targetAddr != myAddress)
    {
        return;
    }
    
    command = U3_Inf.RX_Data[1];
    
    switch(command)
    {
        case 0x03:  /* è¯»å¯„å­˜å™¨ */
            ModBus3_SlaveResponse_Read03();
            break;
        case 0x06:  /* å†™å•å¯„å­˜å™¨ */
            ModBus3_SlaveResponse_Write06();
            break;
        case 0x10:  /* å†™å¤šå¯„å­˜å™¨ */
            ModBus3_SlaveResponse_Write10();
            break;
        default:
            break;
    }
}
```

#### ä¿®æ”¹ç‚¹4: åœ¨æ¥æ”¶å¤„ç†ä¸­è°ƒç”¨ä»æœºå“åº”

```c
// usart3.c: ModBus_Uart3_LocalRX_Communication()
// åœ¨ CRC æ ¡éªŒé€šè¿‡åæ·»åŠ 

if(checksum == ModBusCRC16(U3_Inf.RX_Data, U3_Inf.RX_Length))
{
    Target_Address = U3_Inf.RX_Data[0];
    
    if(sys_flag.Address_Number == 0)
    {
        // ä¸»æœºå¤„ç†ä»æœºè¿”å›çš„æ•°æ®
        if(Target_Address < 8)
        {
            Modbus3_UnionRx_DataProcess(U3_Inf.RX_Data[1], Target_Address);
        }
    }
    else
    {
        /* ===== æ–°å¢ï¼šä»æœºå“åº”ä¸»æœºæŸ¥è¯¢ ===== */
        if(Target_Address == sys_flag.Address_Number)
        {
            ModBus3_SlaveResponse();
        }
    }
    
    // ... å…¶ä½™ç°æœ‰ä»£ç  (åœ°å€8/10çš„å¤„ç†) ...
}
```

---

## 5. ä¿®å¤åçš„æµç¨‹å›¾

```
ä¿®å¤å - æ— æ€»çº¿å†²çª:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    RS485 æ€»çº¿ (ä¸²å£3) - ç›¸å˜åŒæ‹¼æ¨¡å¼                    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

æ—¶é—´çº¿:
  T1        T2        T3        T4        T5        T6
  â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
  â–¼         â–¼         â–¼         â–¼         â–¼         â–¼

ä¸»æœº: [æŸ¥è¯¢ä»æœº2]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[æ”¶åˆ°å“åº”]
              â”‚                        â–²
              â”‚  TX: 02 03 00 64...   â”‚
              â–¼                        â”‚  RX: 02 03 24 ...
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                      RS485 æ€»çº¿
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚                        â–²
              â”‚                        â”‚
              â–¼                        â”‚
ä»æœº:    [æ”¶åˆ°æŸ¥è¯¢]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[å‘é€å“åº”]
                   â”‚
                   â”‚ è§£æå‘½ä»¤
                   â”‚ å‡†å¤‡æ•°æ®(åŒ…å«æ³µ/å·®å‹)
                   â”‚ å‘é€å“åº”
                   â–¼

âœ… ä¸»æœºå‘é€ â†’ ä»æœºæ¥æ”¶ â†’ ä»æœºå“åº” â†’ ä¸»æœºæ¥æ”¶
   ä¸¥æ ¼çš„è¯·æ±‚-å“åº”æ¨¡å¼ï¼Œæ— å†²çªï¼
```

---

## 6. æ•°æ®å¸§æ ¼å¼

### 6.1 ä¸»æœºæŸ¥è¯¢å¸§

```
åœ°å€ åŠŸèƒ½ èµ·å§‹åœ°å€H èµ·å§‹åœ°å€L å¯„å­˜å™¨æ•°H å¯„å­˜å™¨æ•°L CRC_H CRC_L
02   03   00        64        00        12        XX    XX
```

### 6.2 ä»æœºå“åº”å¸§ (åŒ…å«æ³µå’Œå·®å‹æ•°æ®)

```
åœ°å€ åŠŸèƒ½ å­—èŠ‚æ•° æ•°æ®[36å­—èŠ‚] CRC_H CRC_L
02   03   24     [è§ä¸‹è¡¨]    XX    XX
```

### 6.3 æ•°æ®æ˜ å°„è¡¨

| åç§» | å†…å®¹ | è¯´æ˜ |
|------|------|------|
| 3-4 | sys_data.Data_10H | è®¾å¤‡çŠ¶æ€ |
| 5-6 | Pressure_Value | è’¸æ±½å‹åŠ› |
| 15-16 | Error_Code | æ•…éšœç  |
| 17-18 | flame_state | ç«ç„°çŠ¶æ€ |
| 23-24 | now_percent | é£æœºåŠŸç‡ |
| 27-28 | water_switch_flag | **æ°´æ³µçŠ¶æ€** |
| 33-34 | Water_State.ZSignal | **è¡¥æ°´ä¿¡å·** |
| 35-36 | ChaYaWater_Value | **å·®å‹æ¶²ä½** â† ä»æœºæœ¬åœ°æ•°æ® |

---

## 7. å®æ–½è®¡åˆ’

| é˜¶æ®µ | å†…å®¹ | æ–‡ä»¶ |
|------|------|------|
| Phase 1 | ä»æœºè·³è¿‡ case4/5 | `usart3.c` Line 798-800 |
| Phase 2 | æ–°å¢ä»æœºå“åº”å‡½æ•°å£°æ˜ | `usart3.h` |
| Phase 3 | å®ç°ä»æœºå“åº”å‡½æ•° | `usart3.c` |
| Phase 4 | ä¿®æ”¹æ¥æ”¶å¤„ç†ï¼Œè°ƒç”¨ä»æœºå“åº” | `usart3.c` |
| Phase 5 | ä»æœºæœ¬åœ°æŸ¥è¯¢æ³µ/å·®å‹ (ç‹¬ç«‹äºä¸²å£3) | å¯é€‰ |
| Phase 6 | ç¼–è¯‘æµ‹è¯• + ç¡¬ä»¶è”è°ƒ | - |

---

## 8. éªŒæ”¶æ ‡å‡†

- [ ] ä»æœºä¸å†ä¸»åŠ¨åœ¨ä¸²å£3ä¸Šå‘é€æŸ¥è¯¢å‘½ä»¤
- [ ] ä¸»æœºèƒ½ç¨³å®šè¯»å–ä»æœºæ•°æ®ï¼Œä¸å†å¶å‘å¤±è”
- [ ] ä»æœºå“åº”æ•°æ®ä¸­åŒ…å«æ­£ç¡®çš„æ³µçŠ¶æ€å’Œå·®å‹å€¼
- [ ] LCDæ˜¾ç¤º"åˆ†æœºè¿çº¿ï¼Œæ­£å¸¸"
- [ ] è”åŠ¨å¯åœåŠŸèƒ½æ­£å¸¸

---

## 9. é£é™©è¯„ä¼°

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| ä»æœºæ— æ³•æ§åˆ¶è‡ªå·±çš„æ³µ | éœ€è¦ä¸»æœºè½¬å‘å‘½ä»¤ | ä¸»æœºåœ¨å†™å‚æ•°æ—¶åŒæ­¥ç»™ä»æœº |
| å“åº”è¶…æ—¶ | ä¸»æœºä»æ˜¾ç¤ºå¤±è” | ç¡®ä¿å“åº”åœ¨100mså†… |
| åè®®å…¼å®¹æ€§ | æ—§ç‰ˆæœ¬ä¸»æœºæ— æ³•è§£æ | ä¿æŒæ•°æ®æ ¼å¼ä¸å˜ |

---

## 10. é—®é¢˜æ€»ç»“

| é¡¹ç›® | åŸåˆ†æ | æ­£ç¡®åˆ†æ |
|------|--------|----------|
| **æ ¹å› ** | ä»æœºç¼ºå°‘å“åº”ä»£ç  | **æ€»çº¿å†²çª**: ä¸»æœºå’Œä»æœºåŒæ—¶å‘é€ |
| **ä½ç½®** | - | `usart3.c` Line 798-800, 834, 866 |
| **è¡¨ç°** | æŒç»­å¤±è” | **å¶å‘å¤±è”** (æ—¶åºç¢°æ’) |
| **ä¿®å¤** | æ·»åŠ ä»æœºå“åº” | ä»æœºåœæ­¢ä¸»åŠ¨å‘é€ + æ·»åŠ å“åº” |

---

**è¯·å®¡æ‰¹æ­¤æ–¹æ¡ˆï¼Œæ‰¹å‡†åå¼€å§‹å®æ–½ã€‚**
