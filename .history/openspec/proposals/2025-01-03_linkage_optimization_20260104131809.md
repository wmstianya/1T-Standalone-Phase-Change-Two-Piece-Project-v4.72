# ä¸»ä»æœºè”åŠ¨ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“‹ å˜æ›´è¯·æ±‚

**è¯·æ±‚æ—¥æœŸ**: 2025-01-03  
**å˜æ›´ç±»å‹**: åŠŸèƒ½ä¼˜åŒ–  
**å½±å“èŒƒå›´**: `HARDWARE/USART3/usart3.c` - `Union_MuxJiZu_Control_Function()`  
**çŠ¶æ€**: âœ… å·²å®æ–½ (æ–¹æ¡ˆä¸€ + æ–¹æ¡ˆäºŒ)

## ğŸ“Œ å®æ–½å†³å®š

| æ–¹æ¡ˆ | å†³å®š | å‚æ•° |
|------|------|------|
| æ–¹æ¡ˆä¸€: å¢å‡è½½å“åº”ä¼˜åŒ– | âœ… é‡‡ç”¨ | å‹åŠ›é¢„æµ‹çª—å£30ç§’ |
| æ–¹æ¡ˆäºŒ: è¿è¡Œæ—¶é—´å‡è¡¡ | âœ… é‡‡ç”¨ | è½®æ¢å‘¨æœŸ4å°æ—¶ |
| æ–¹æ¡ˆä¸‰: æ•…éšœæ¢å¤è‡ªåŠ¨é‡å…¥ | âŒ æš‚ä¸é‡‡ç”¨ | - |

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

| åºå· | ä¼˜åŒ–æ–¹å‘ | å½“å‰é—®é¢˜ | ç›®æ ‡ |
|------|----------|----------|------|
| 1 | å¢å‡è½½å“åº”é€Ÿåº¦ | å›ºå®š15ç§’å‘¨æœŸ+æ—¶é—´é˜ˆå€¼ï¼Œå“åº”æ…¢ | å‹åŠ›é¢„æµ‹ï¼Œæå‰å“åº” |
| 2 | è¿è¡Œæ—¶é—´å‡è¡¡ | ä»…å¢å‡è½½æ—¶è€ƒè™‘å‡è¡¡ | ä¸»åŠ¨è½®æ¢ï¼Œç£¨æŸå‡è¡¡ |
| 3 | æ•…éšœæ¢å¤è‡ªåŠ¨é‡å…¥ | æ•…éšœæœºç»„æ¢å¤åä¸è‡ªåŠ¨çº³å…¥ | è‡ªåŠ¨æ£€æµ‹æ¢å¤ï¼Œé‡æ–°çº³å…¥ |

---

## ğŸ“Š æ–¹æ¡ˆä¸€ï¼šå¢å‡è½½å“åº”é€Ÿåº¦ä¼˜åŒ–

### 1.1 å½“å‰å®ç°åˆ†æ

```c
// å½“å‰: å›ºå®š15ç§’å‘¨æœŸ + å›ºå®šæ—¶é—´é˜ˆå€¼
Period_Check++;
if(Period_Check >= 15) {  // 15ç§’å‘¨æœŸ
    for(Address = 1; Address <= 10; Address++) {
        if(SlaveG[Address].Big_time > Sys_Admin.Balance_Big_Time)  // é»˜è®¤90ç§’
            Value_Buffer2++;
        if(SlaveG[Address].Small_time > Sys_Admin.Balance_Small_Time) // é»˜è®¤150ç§’
            Value_Buffer++;
    }
}
```

**é—®é¢˜**: 
- æœ€å¿«å“åº”æ—¶é—´ = 15ç§’å‘¨æœŸ + 90/150ç§’é˜ˆå€¼ â‰ˆ **105-165ç§’**
- æ— æ³•åº”å¯¹çªå‘è´Ÿè·å˜åŒ–ï¼ˆå¦‚ç”¨æ±½è®¾å¤‡çªç„¶å¯åŠ¨ï¼‰
- å‹åŠ›å¯èƒ½å·²ç»è¿‡ä½æ‰å¼€å§‹å¢è½½

### 1.2 ä¼˜åŒ–æ–¹æ¡ˆAï¼šå‹åŠ›å˜åŒ–ç‡é¢„æµ‹

**æ ¸å¿ƒæ€æƒ³**: æ ¹æ®å‹åŠ›ä¸‹é™/ä¸Šå‡é€Ÿç‡é¢„æµ‹ï¼Œæå‰è§¦å‘å¢å‡è½½

```c
typedef struct {
    float pressureHistory[5];   // æœ€è¿‘5ç§’å‹åŠ›å†å²
    uint8_t historyIndex;       // ç¯å½¢ç¼“å†²åŒºç´¢å¼•
    float pressureRate;         // å‹åŠ›å˜åŒ–ç‡ (MPa/s)
    float predictedPressure;    // é¢„æµ‹å‹åŠ›å€¼
} PressurePredictor;

/* å‹åŠ›å˜åŒ–ç‡è®¡ç®— (æ¯ç§’è°ƒç”¨) */
void Pressure_UpdateRate(PressurePredictor *pred, float currentPressure)
{
    pred->pressureHistory[pred->historyIndex] = currentPressure;
    pred->historyIndex = (pred->historyIndex + 1) % 5;
    
    // è®¡ç®—5ç§’å†…çš„å¹³å‡å˜åŒ–ç‡
    float oldestPressure = pred->pressureHistory[pred->historyIndex];
    pred->pressureRate = (currentPressure - oldestPressure) / 5.0f;
    
    // é¢„æµ‹30ç§’åçš„å‹åŠ›
    pred->predictedPressure = currentPressure + pred->pressureRate * 30.0f;
}

/* å¢å‡è½½å†³ç­–å¢å¼º */
uint8_t Linkage_ShouldAddUnit(PressurePredictor *pred, float setpoint)
{
    // æ¡ä»¶1: ä¼ ç»Ÿæ¡ä»¶ - æ‰€æœ‰æœºç»„æ»¡åŠŸç‡è¶…æ—¶
    if(allUnitsBigTimeExceeded) return 1;
    
    // æ¡ä»¶2: é¢„æµ‹æ¡ä»¶ - å‹åŠ›å¿«é€Ÿä¸‹é™ï¼Œé¢„æµ‹å°†ä½äºé˜ˆå€¼
    if(pred->pressureRate < -0.01f &&  // å‹åŠ›ä¸‹é™é€Ÿç‡ > 0.01 MPa/s
       pred->predictedPressure < setpoint * 0.9f) {
        return 1;  // æå‰å¢è½½
    }
    
    return 0;
}
```

**ä¼˜ç‚¹**:
- å“åº”æ—¶é—´ä» 105ç§’ â†’ **15-30ç§’**
- å‹åŠ›æ³¢åŠ¨æ›´å¹³ç¨³
- é€‚åº”çªå‘è´Ÿè·å˜åŒ–

**ç¼ºç‚¹**:
- å¢åŠ å°‘é‡è®¡ç®—å¼€é”€
- éœ€è¦è°ƒè¯•é¢„æµ‹å‚æ•°

### 1.3 ä¼˜åŒ–æ–¹æ¡ˆBï¼šè‡ªé€‚åº”å‘¨æœŸè¯„ä¼°

**æ ¸å¿ƒæ€æƒ³**: æ ¹æ®ç³»ç»Ÿè´Ÿè·åŠ¨æ€è°ƒæ•´è¯„ä¼°å‘¨æœŸ

```c
typedef struct {
    uint8_t basePeriod;         // åŸºç¡€å‘¨æœŸ (ç§’)
    uint8_t currentPeriod;      // å½“å‰å‘¨æœŸ
    uint8_t loadLevel;          // è´Ÿè·ç­‰çº§: 0=è½»è½½, 1=ä¸­è½½, 2=é‡è½½, 3=ä¸´ç•Œ
} AdaptivePeriod;

/* è‡ªé€‚åº”å‘¨æœŸè®¡ç®— */
void Linkage_UpdatePeriod(AdaptivePeriod *ap, uint8_t avgPower, float pressure, float setpoint)
{
    // è®¡ç®—è´Ÿè·ç­‰çº§
    float pressureRatio = pressure / setpoint;
    
    if(avgPower >= 90 || pressureRatio < 0.85f) {
        ap->loadLevel = 3;  // ä¸´ç•Œ: é«˜åŠŸç‡æˆ–ä½å‹åŠ›
        ap->currentPeriod = 3;  // 3ç§’å‘¨æœŸ
    }
    else if(avgPower >= 70 || pressureRatio < 0.95f) {
        ap->loadLevel = 2;  // é‡è½½
        ap->currentPeriod = 5;  // 5ç§’å‘¨æœŸ
    }
    else if(avgPower >= 45) {
        ap->loadLevel = 1;  // ä¸­è½½
        ap->currentPeriod = 10; // 10ç§’å‘¨æœŸ
    }
    else {
        ap->loadLevel = 0;  // è½»è½½
        ap->currentPeriod = 15; // 15ç§’å‘¨æœŸ (ç»´æŒåŸå€¼)
    }
}
```

**ä¼˜ç‚¹**:
- å®ç°ç®€å•ï¼Œæ”¹åŠ¨å°
- ä¸´ç•ŒçŠ¶æ€å“åº”å¿«ï¼Œç¨³æ€æ—¶èŠ‚çœèµ„æº

**ç¼ºç‚¹**:
- æ— é¢„æµ‹èƒ½åŠ›ï¼Œä»æ˜¯è¢«åŠ¨å“åº”

### 1.4 æ¨èæ–¹æ¡ˆ

**æ¨è: æ–¹æ¡ˆA + æ–¹æ¡ˆB ç»“åˆ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¢å‡è½½å†³ç­–æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å‹åŠ›é¢„æµ‹å™¨  â”‚â”€â”€â”€â–¶â”‚ è‡ªé€‚åº”å‘¨æœŸ  â”‚â”€â”€â”€â–¶â”‚ å¢å‡è½½å†³ç­–  â”‚ â”‚
â”‚  â”‚ (æ¯ç§’æ›´æ–°)  â”‚    â”‚ (åŠ¨æ€è°ƒæ•´)  â”‚    â”‚ (ç»¼åˆåˆ¤æ–­)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â”‚                  â”‚                  â”‚         â”‚
â”‚        â–¼                  â–¼                  â–¼         â”‚
â”‚  pressureRate       currentPeriod      Need_flag       â”‚
â”‚  predictedPressure  loadLevel          Loss_flag       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ–¹æ¡ˆäºŒï¼šè¿è¡Œæ—¶é—´å‡è¡¡ç®—æ³•æ”¹è¿›

### 2.1 å½“å‰å®ç°åˆ†æ

```c
// å½“å‰: ä»…åœ¨å¢è½½æ—¶é€‰æ‹©è¿è¡Œæ—¶é—´æœ€çŸ­çš„æœºç»„
if(LCD10JZ[Address].DLCD.Device_State == 1) {  // å¾…æœºçŠ¶æ€
    if(Min_Time > LCD10JZ[Address].DLCD.Work_Time) {
        Min_Time = LCD10JZ[Address].DLCD.Work_Time;
        Min_Address = Address;  // é€‰æ‹©è¿è¡Œæ—¶é—´æœ€çŸ­çš„
    }
}

// å‡è½½æ—¶é€‰æ‹©è¿è¡Œæ—¶é—´æœ€é•¿çš„
if(Max_time < LCD10JZ[Address].DLCD.Work_Time) {
    Max_Address = Address;
    Max_time = SlaveG[Address].Work_Time;
}
```

**é—®é¢˜**:
- åªåœ¨å¢å‡è½½æ—¶è€ƒè™‘å‡è¡¡ï¼Œæ—¥å¸¸è¿è¡Œä¸è½®æ¢
- é•¿æœŸè¿è¡Œåï¼Œéƒ¨åˆ†æœºç»„ç£¨æŸä¸¥é‡ï¼Œéƒ¨åˆ†æœºç»„é—²ç½®
- æ— æ³•ä¿è¯æ‰€æœ‰æœºç»„å¾—åˆ°å‡è¡¡ä½¿ç”¨

### 2.2 ä¼˜åŒ–æ–¹æ¡ˆAï¼šå®šæ—¶è½®æ¢æœºåˆ¶

**æ ¸å¿ƒæ€æƒ³**: å‘¨æœŸæ€§å¼ºåˆ¶è½®æ¢è¿è¡Œæœºç»„

```c
typedef struct {
    uint32_t rotationPeriod;    // è½®æ¢å‘¨æœŸ (åˆ†é’Ÿ)
    uint32_t lastRotationTime;  // ä¸Šæ¬¡è½®æ¢æ—¶é—´
    uint8_t rotationEnabled;    // è½®æ¢ä½¿èƒ½æ ‡å¿—
} RotationConfig;

/* è½®æ¢æ£€æŸ¥ (æ¯åˆ†é’Ÿè°ƒç”¨) */
uint8_t Linkage_CheckRotation(RotationConfig *cfg, uint32_t currentMinutes)
{
    if(!cfg->rotationEnabled) return 0;
    
    // æ£€æŸ¥æ˜¯å¦åˆ°è½®æ¢å‘¨æœŸ (é»˜è®¤4å°æ—¶ = 240åˆ†é’Ÿ)
    if((currentMinutes - cfg->lastRotationTime) >= cfg->rotationPeriod) {
        cfg->lastRotationTime = currentMinutes;
        return 1;  // éœ€è¦è½®æ¢
    }
    return 0;
}

/* æ‰§è¡Œè½®æ¢ */
void Linkage_DoRotation(void)
{
    uint8_t maxWorkAddr = 0, minWorkAddr = 0;
    uint32_t maxWorkTime = 0, minWorkTime = 0xFFFFFFFF;
    
    // æ‰¾å‡ºè¿è¡Œä¸­å·¥ä½œæ—¶é—´æœ€é•¿çš„æœºç»„
    // æ‰¾å‡ºå¾…æœºä¸­å·¥ä½œæ—¶é—´æœ€çŸ­çš„æœºç»„
    for(uint8_t i = 1; i <= 10; i++) {
        if(SlaveG[i].Alive_Flag && LCD10JZ[i].DLCD.YunXu_Flag) {
            if(LCD10JZ[i].DLCD.Device_State == 2) {  // è¿è¡Œä¸­
                if(LCD10JZ[i].DLCD.Work_Time > maxWorkTime) {
                    maxWorkTime = LCD10JZ[i].DLCD.Work_Time;
                    maxWorkAddr = i;
                }
            }
            else if(LCD10JZ[i].DLCD.Device_State == 1) {  // å¾…æœº
                if(LCD10JZ[i].DLCD.Work_Time < minWorkTime) {
                    minWorkTime = LCD10JZ[i].DLCD.Work_Time;
                    minWorkAddr = i;
                }
            }
        }
    }
    
    // å·¥ä½œæ—¶é—´å·®å¼‚è¶…è¿‡é˜ˆå€¼æ—¶æ‰§è¡Œè½®æ¢
    if(maxWorkAddr && minWorkAddr && (maxWorkTime - minWorkTime) > ROTATION_THRESHOLD) {
        // å…³é—­è¿è¡Œæ—¶é—´æœ€é•¿çš„
        SlaveG[maxWorkAddr].Startclose_Sendflag = 3;
        SlaveG[maxWorkAddr].Startclose_Data = 0;
        
        // å¯åŠ¨è¿è¡Œæ—¶é—´æœ€çŸ­çš„
        SlaveG[minWorkAddr].Startclose_Sendflag = 3;
        SlaveG[minWorkAddr].Startclose_Data = 1;
    }
}
```

### 2.3 ä¼˜åŒ–æ–¹æ¡ˆBï¼šåŠ æƒä¼˜å…ˆçº§é€‰æ‹©

**æ ¸å¿ƒæ€æƒ³**: ç»¼åˆè€ƒè™‘å¤šå› ç´ çš„ä¼˜å…ˆçº§ç®—æ³•

```c
typedef struct {
    float workTimeWeight;       // è¿è¡Œæ—¶é—´æƒé‡ (é»˜è®¤0.5)
    float lastRunWeight;        // ä¸Šæ¬¡è¿è¡Œè·ä»Šæ—¶é—´æƒé‡ (é»˜è®¤0.3)
    float efficiencyWeight;     // æ•ˆç‡æƒé‡ (é»˜è®¤0.2)
} SelectionWeights;

/* è®¡ç®—æœºç»„ä¼˜å…ˆçº§åˆ†æ•° (åˆ†æ•°è¶Šé«˜ï¼Œè¶Šä¼˜å…ˆå¯åŠ¨) */
float Linkage_CalcPriority(uint8_t address, SelectionWeights *w)
{
    float score = 0.0f;
    uint32_t maxWorkTime = GetMaxWorkTime();  // è·å–æœ€å¤§è¿è¡Œæ—¶é—´
    uint32_t myWorkTime = LCD10JZ[address].DLCD.Work_Time;
    
    // è¿è¡Œæ—¶é—´è¶ŠçŸ­ï¼Œåˆ†æ•°è¶Šé«˜
    if(maxWorkTime > 0) {
        score += w->workTimeWeight * (1.0f - (float)myWorkTime / maxWorkTime);
    }
    
    // ä¸Šæ¬¡è¿è¡Œè·ä»Šæ—¶é—´è¶Šé•¿ï¼Œåˆ†æ•°è¶Šé«˜ (é¿å…é¢‘ç¹å¯åœåŒä¸€æœºç»„)
    uint32_t idleTime = GetIdleTime(address);
    score += w->lastRunWeight * (idleTime / 3600.0f);  // æ¯å°æ—¶0.3åˆ†
    
    // å¯é€‰: æ•ˆç‡å› å­ (å¦‚æœæœ‰æ•ˆç‡æ•°æ®)
    // score += w->efficiencyWeight * efficiency[address];
    
    return score;
}

/* é€‰æ‹©æœ€ä¼˜æœºç»„å¯åŠ¨ */
uint8_t Linkage_SelectBestUnit(void)
{
    float maxScore = -1.0f;
    uint8_t bestAddr = 0;
    SelectionWeights weights = {0.5f, 0.3f, 0.2f};
    
    for(uint8_t i = 1; i <= 10; i++) {
        if(IsUnitAvailable(i) && LCD10JZ[i].DLCD.Device_State == 1) {
            float score = Linkage_CalcPriority(i, &weights);
            if(score > maxScore) {
                maxScore = score;
                bestAddr = i;
            }
        }
    }
    
    return bestAddr;
}
```

### 2.4 æ¨èæ–¹æ¡ˆ

**æ¨è: æ–¹æ¡ˆA (å®šæ—¶è½®æ¢) + æ–¹æ¡ˆB (åŠ æƒé€‰æ‹©)**

| åœºæ™¯ | ä½¿ç”¨ç®—æ³• |
|------|----------|
| å¢è½½é€‰æ‹© | åŠ æƒä¼˜å…ˆçº§ç®—æ³• |
| å‡è½½é€‰æ‹© | è¿è¡Œæ—¶é—´æœ€é•¿ä¼˜å…ˆ |
| å®šæ—¶è½®æ¢ | å‘¨æœŸæ€§å¼ºåˆ¶è½®æ¢ |

---

## ğŸ“Š æ–¹æ¡ˆä¸‰ï¼šæ•…éšœæ¢å¤è‡ªåŠ¨é‡å…¥è”åŠ¨

### 3.1 å½“å‰å®ç°åˆ†æ

```c
// å½“å‰: æ•…éšœæ—¶æ ‡è®°ä¸å¯ç”¨ï¼Œä½†æ— æ¢å¤æœºåˆ¶
if(LCD10JZ[Address].DLCD.Error_Code == 0) {  // æ— æ•…éšœ
    AliveOk_Numbres++;
    // ... çº³å…¥è”åŠ¨
}
// æœ‰æ•…éšœæ—¶ç›´æ¥è·³è¿‡ï¼Œæ— åç»­å¤„ç†
```

**é—®é¢˜**:
- æ•…éšœæœºç»„æ¢å¤åéœ€è¦æ‰‹åŠ¨å¤ä½
- æ— è‡ªåŠ¨æ£€æµ‹æ•…éšœæ¢å¤çš„é€»è¾‘
- å¯èƒ½å¯¼è‡´å¯ç”¨æœºç»„å‡å°‘

### 3.2 ä¼˜åŒ–æ–¹æ¡ˆï¼šæ•…éšœæ¢å¤è‡ªåŠ¨æ£€æµ‹

```c
typedef struct {
    uint8_t lastErrorCode;      // ä¸Šä¸€æ¬¡æ•…éšœç 
    uint8_t currentErrorCode;   // å½“å‰æ•…éšœç 
    uint8_t recoverCount;       // æ¢å¤ç¡®è®¤è®¡æ•°
    uint8_t autoResetEnabled;   // è‡ªåŠ¨å¤ä½ä½¿èƒ½
    uint32_t faultTime;         // æ•…éšœå‘ç”Ÿæ—¶é—´
    uint32_t recoverTime;       // æ¢å¤ç¡®è®¤æ—¶é—´
} FaultRecovery;

FaultRecovery faultRecovery[11];  // 1-10å·ä»æœº

/* æ•…éšœæ¢å¤æ£€æµ‹ (æ¯ç§’è°ƒç”¨) */
void Linkage_CheckFaultRecovery(uint8_t address)
{
    FaultRecovery *fr = &faultRecovery[address];
    uint8_t currentError = LCD10JZ[address].DLCD.Error_Code;
    
    // çŠ¶æ€å˜åŒ–æ£€æµ‹
    if(currentError != fr->lastErrorCode) {
        if(fr->lastErrorCode != 0 && currentError == 0) {
            // ä»æ•…éšœâ†’æ­£å¸¸: å¼€å§‹æ¢å¤ç¡®è®¤
            fr->recoverCount = 1;
            fr->recoverTime = GetCurrentSeconds();
        }
        else if(currentError != 0) {
            // æ–°æ•…éšœå‘ç”Ÿ
            fr->faultTime = GetCurrentSeconds();
            fr->recoverCount = 0;
        }
        fr->lastErrorCode = currentError;
    }
    
    // æ¢å¤ç¡®è®¤ (è¿ç»­30ç§’æ— æ•…éšœ)
    if(fr->recoverCount > 0 && currentError == 0) {
        if((GetCurrentSeconds() - fr->recoverTime) >= 30) {
            fr->recoverCount = 0;
            
            // è‡ªåŠ¨å¤ä½: é‡æ–°çº³å…¥è”åŠ¨
            if(fr->autoResetEnabled) {
                Linkage_ReenableUnit(address);
                
                // å¯é€‰: ä¸ŠæŠ¥æ¢å¤äº‹ä»¶
                LogEvent(EVENT_FAULT_RECOVERED, address);
            }
        }
    }
}

/* é‡æ–°çº³å…¥è”åŠ¨ */
void Linkage_ReenableUnit(uint8_t address)
{
    // é‡ç½®çŠ¶æ€
    SlaveG[address].Big_time = 0;
    SlaveG[address].Small_time = 0;
    SlaveG[address].Zero_time = 0;
    
    // ç¡®ä¿ä½¿èƒ½æ ‡å¿—æœ‰æ•ˆ
    if(SlaveG[address].Key_Power && SlaveG[address].Alive_Flag) {
        // æœºç»„å·²å‡†å¤‡å¥½é‡æ–°åŠ å…¥è”åŠ¨
        // ä¸‹æ¬¡å¢è½½å†³ç­–æ—¶ä¼šè‡ªåŠ¨è€ƒè™‘è¯¥æœºç»„
        
        // å¯é€‰: ç«‹å³è§¦å‘ä¸€æ¬¡è”åŠ¨è¯„ä¼°
        // Linkage_ForceEvaluate();
    }
}
```

### 3.3 å®‰å…¨è€ƒè™‘

```c
/* æ•…éšœç±»å‹åˆ†ç±» */
typedef enum {
    FAULT_CLASS_RECOVERABLE,    // å¯æ¢å¤æ•…éšœ (å¦‚è¶…æ¸©ã€è¶…å‹)
    FAULT_CLASS_MANUAL_RESET,   // éœ€æ‰‹åŠ¨å¤ä½ (å¦‚ç«ç„°ä¸¢å¤±ã€ç‚¹ç«å¤±è´¥)
    FAULT_CLASS_CRITICAL        // ä¸¥é‡æ•…éšœ (éœ€æ£€ä¿®)
} FaultClass;

/* è·å–æ•…éšœåˆ†ç±» */
FaultClass GetFaultClass(uint8_t errorCode)
{
    switch(errorCode) {
        case ERROR_OVER_TEMP:       // è¶…æ¸©
        case ERROR_OVER_PRESSURE:   // è¶…å‹
        case ERROR_LOW_WATER:       // ç¼ºæ°´
            return FAULT_CLASS_RECOVERABLE;
            
        case ERROR_FLAME_LOST:      // ç«ç„°ä¸¢å¤±
        case ERROR_IGNITION_FAIL:   // ç‚¹ç«å¤±è´¥
            return FAULT_CLASS_MANUAL_RESET;
            
        case ERROR_SENSOR_FAIL:     // ä¼ æ„Ÿå™¨æ•…éšœ
        case ERROR_HARDWARE:        // ç¡¬ä»¶æ•…éšœ
            return FAULT_CLASS_CRITICAL;
            
        default:
            return FAULT_CLASS_MANUAL_RESET;
    }
}

/* æ˜¯å¦å…è®¸è‡ªåŠ¨æ¢å¤ */
uint8_t IsAutoRecoveryAllowed(uint8_t address)
{
    uint8_t errorCode = faultRecovery[address].lastErrorCode;
    FaultClass faultClass = GetFaultClass(errorCode);
    
    // åªæœ‰å¯æ¢å¤ç±»æ•…éšœå…è®¸è‡ªåŠ¨é‡å…¥
    return (faultClass == FAULT_CLASS_RECOVERABLE);
}
```

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šå¢å‡è½½å“åº”ä¼˜åŒ– (1-2å‘¨)

| æ­¥éª¤ | å†…å®¹ | å·¥ä½œé‡ |
|------|------|--------|
| 1.1 | å®ç°å‹åŠ›å˜åŒ–ç‡è®¡ç®—æ¨¡å— | 0.5å¤© |
| 1.2 | å®ç°è‡ªé€‚åº”å‘¨æœŸæ¨¡å— | 0.5å¤© |
| 1.3 | é›†æˆåˆ° Union_MuxJiZu_Control_Function | 1å¤© |
| 1.4 | æµ‹è¯•å’Œå‚æ•°è°ƒè¯• | 2å¤© |

### é˜¶æ®µäºŒï¼šè¿è¡Œæ—¶é—´å‡è¡¡ä¼˜åŒ– (1å‘¨)

| æ­¥éª¤ | å†…å®¹ | å·¥ä½œé‡ |
|------|------|--------|
| 2.1 | å®ç°å®šæ—¶è½®æ¢æ¨¡å— | 0.5å¤© |
| 2.2 | å®ç°åŠ æƒä¼˜å…ˆçº§é€‰æ‹© | 0.5å¤© |
| 2.3 | å¢åŠ LCDé…ç½®ç•Œé¢ | 1å¤© |
| 2.4 | æµ‹è¯•éªŒè¯ | 1å¤© |

### é˜¶æ®µä¸‰ï¼šæ•…éšœæ¢å¤è‡ªåŠ¨é‡å…¥ (1å‘¨)

| æ­¥éª¤ | å†…å®¹ | å·¥ä½œé‡ |
|------|------|--------|
| 3.1 | å®ç°æ•…éšœæ¢å¤æ£€æµ‹æ¨¡å— | 0.5å¤© |
| 3.2 | å®ç°æ•…éšœåˆ†ç±»é€»è¾‘ | 0.5å¤© |
| 3.3 | é›†æˆå’Œå®‰å…¨æµ‹è¯• | 1å¤© |
| 3.4 | ç°åœºéªŒè¯ | 1å¤© |

---

## ğŸ“ æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `HARDWARE/USART3/usart3.c` | ä¿®æ”¹ | Union_MuxJiZu_Control_Function ä¸»ä½“ä¼˜åŒ– |
| `HARDWARE/USART3/usart3.h` | ä¿®æ”¹ | æ–°å¢æ•°æ®ç»“æ„å£°æ˜ |
| `SYSTEM/linkage/linkage_ctrl.c` | æ–°å»º | è”åŠ¨ä¼˜åŒ–æ¨¡å— (å¯é€‰ç‹¬ç«‹æ¨¡å—) |
| `SYSTEM/linkage/linkage_ctrl.h` | æ–°å»º | è”åŠ¨ä¼˜åŒ–å¤´æ–‡ä»¶ |
| `HARDWARE/USART2/usart2.c` | ä¿®æ”¹ | LCDé…ç½®æ¥å£ |
| `SYSTEM/config/sys_config.c` | ä¿®æ”¹ | æ–°å‚æ•°åˆå§‹åŒ– |

---

## âš ï¸ é£é™©è¯„ä¼°

| é£é™© | ç­‰çº§ | ç¼“è§£æªæ–½ |
|------|------|----------|
| é¢„æµ‹è¯¯å·®å¯¼è‡´è¯¯å¢è½½ | ä¸­ | è®¾ç½®é¢„æµ‹è§¦å‘çš„æœ€å°å‹åŠ›å·®é˜ˆå€¼ |
| é¢‘ç¹è½®æ¢å¢åŠ ç£¨æŸ | ä½ | è®¾ç½®æœ€å°è½®æ¢é—´éš” (å¦‚4å°æ—¶) |
| æ•…éšœè‡ªåŠ¨æ¢å¤å®‰å…¨æ€§ | é«˜ | ä¸¥æ ¼æ•…éšœåˆ†ç±»ï¼Œå±é™©æ•…éšœä¸è‡ªåŠ¨æ¢å¤ |
| å‚æ•°é…ç½®å¤æ‚ | ä½ | æä¾›åˆç†é»˜è®¤å€¼ï¼Œé«˜çº§å‚æ•°éšè— |

---

## ğŸ“ å¾…ç¡®è®¤äº‹é¡¹

1. [ ] å‹åŠ›é¢„æµ‹çš„é¢„æµ‹æ—¶é—´çª—å£ (å»ºè®®30ç§’)
2. [ ] è½®æ¢å‘¨æœŸé»˜è®¤å€¼ (å»ºè®®4å°æ—¶)
3. [ ] æ•…éšœæ¢å¤ç¡®è®¤æ—¶é—´ (å»ºè®®30ç§’)
4. [ ] å“ªäº›æ•…éšœå…è®¸è‡ªåŠ¨æ¢å¤
5. [ ] æ˜¯å¦éœ€è¦åˆ›å»ºç‹¬ç«‹çš„ linkage_ctrl æ¨¡å—

---

**è¯·ç¡®è®¤æ˜¯å¦æ‰¹å‡†è¯¥ä¼˜åŒ–æ–¹æ¡ˆï¼Œæˆ–éœ€è¦è¿›ä¸€æ­¥è®¨è®ºå…·ä½“ç»†èŠ‚ã€‚**

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2025-01-03*  
*ä½œè€…: AI Assistant*

